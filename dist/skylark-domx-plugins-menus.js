/**
 * skylark-domx-plugins-menus - The skylark menu plugin library.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-plugins-menus/
 * @license MIT
 */
!function(e,t){var s=t.define,require=t.require,i="function"==typeof s&&s.amd,n=!i&&"undefined"!=typeof exports;if(!i&&!s){var a={};s=t.define=function(e,t,s){"function"==typeof s?(a[e]={factory:s,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var s=t.split("/"),i=e.split("/");s.pop();for(var n=0;n<i.length;n++)"."!=i[n]&&(".."==i[n]?s.pop():s.push(i[n]));return s.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):a[e]={factory:null,resolved:!0,exports:s}},require=t.require=function(e){if(!a.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=a[e];if(!module.resolved){var s=[];module.deps.forEach(function(e){s.push(require(e))}),module.exports=module.factory.apply(t,s)||null,module.resolved=!0}return module.exports}}if(!s)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-domx-plugins-menus/menus",["skylark-langx/skylark"],function(e){return e.attach("domx.plugins.menus")}),e("skylark-domx-plugins-menus/menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus"],function(e,t,s,i,n){"use strict";var a=i.Plugin.inherit({klassName:"Menu",pluginName:"lark.menus.menu",options:{template:"",classes:{base:"lark-menu"},selectors:{container:null},item:{templates:{general:'<li class="menu-item"><a href="#" class="link"><%= title %></a></li>',separator:"",hasChildren:'<li class="menu-item hasChildren"><a href="#" class="link"><%= title %></a><ul class="submenu"></ul>'},classes:{base:"menu-item",active:"active",hasChildren:"hasChildren"},selectors:{general:"li",hasChildren:":has(ul)"}},submenu:{template:"<ul></ul>",classes:{base:"submenu"},selectors:{children:"> ul",descendant:"ul"}},data:{},onAction:null},_construct:function(e,s){i.Plugin.prototype._construct.call(this,e,s),this._$container=this.$(this.options.selectors.container),this.options.onAction&&this.listenTo(this._$container,"click",`.${this.options.item.classes.base}`,e=>{var s=t(e.currentTarget).data("item");this.options.onAction(s)})},renderMenuItemHtml:function(t){if(!this._renderItemHtml){let t=this.options.item.template;e.isString(t)?this._renderItemHtml=e.template(t):e.isFunction(t)&&(this._renderItemHtml=t)}return this._renderItemHtml(t)},renderGeneralMenuItem:function(s){if(!this._renderGeneralItemHtml){let t=this.options.item.templates.general;e.isString(t)?this._renderGeneralItemHtml=e.template(t):e.isFunction(t)&&(this._renderGeneralItemHtml=t)}return t(this._renderGeneralItemHtml(s))},renderHasChildrenMenuItem:function(s){if(!this._renderHasChildrenItemHtml){let t=this.options.item.templates.hasChildren;e.isString(t)?this._renderHasChildrenItemHtml=e.template(t):e.isFunction(t)&&(this._renderHasChildrenItemHtml=t)}return t(this._renderHasChildrenItemHtml(s))}});return i.register(a),n.Menu=a}),e("skylark-domx-plugins-menus/accordion-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu"],function(e,t,s,i,n,a){"use strict";var l=a.inherit({klassName:"AccordionMenu",pluginName:"lark.menus.accordion",_construct:function(e,t){a.prototype._construct.call(this,e,t),s.multitier(e,{togglable:!0,classes:{active:this.options.item.classes.active},selectors:{item:this.options.item.selectors.general,sublist:this.options.submenu.selectors.descendant,hasSublist:this.options.item.selectors.hasChildren},multiExpand:!1})}});return i.register(l),n.AccordionMenu=l}),e("skylark-domx-plugins-menus/cascade-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu"],function(e,t,s,i,n,a){"use strict";var l=a.inherit({klassName:"CascadeMenu",pluginName:"lark.menus.cascade",_construct:function(e,t){a.prototype._construct.call(this,e,t),s.multitier(e,{togglable:!0,classes:{active:this.options.item.classes.active},selectors:{item:this.options.item.selectors.general,sublist:this.options.submenu.selectors.descendant,hasSublist:this.options.item.selectors.hasChildren},multiExpand:!1})}});return i.register(l),n.CascadeMenu=l}),e("skylark-domx-plugins-menus/nav-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu"],function(e,t,s,i,n,a){"use strict";var l=a.inherit({klassName:"NavMenu",pluginName:"lark.menus.nav",options:{item:{templates:{}}},_construct:function(e,t){a.prototype._construct.call(this,e,t),this.options.data.items&&this.resetItems(this.options.data.items),s.multitier(e,{togglable:!1,classes:{active:this.options.item.classes.active},selectors:{item:this.options.item.selectors.general,sublist:this.options.submenu.selectors.descendant,hasSublist:this.options.item.selectors.hasChildren},multiExpand:!1})},resetItems:function(e){let t=this;let s=this.$(this.options.selectors.container);e.forEach(e=>{!function e(s,i){let n;n=s.children?t.renderHasChildrenMenuItem(s):t.renderGeneralMenuItem(s);n.data("item",s);i.append(n);if(s.children){let i=n.find(t.options.submenu.selectors.children);s.children.forEach(t=>{e(t,i)})}}(e,s)})}});return i.register(l),n.NavMenu=l}),e("skylark-domx-plugins-menus/tree-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu","skylark-domx-plugins-toggles"],function(e,t,s,i,n,a){"use strict";var l=a.inherit({klassName:"Tree",pluginName:"lark.menus.tree",_construct:function(t,i){a.prototype._construct.call(this,t,i),s.multitier(t,e.mixin({hide:function(e){e.plugin("lark.toggles.collapse").hide()},toggle:function(e){e.plugin("lark.toggles.collapse").toggle()}},this.options))}});return i.register(l),n.TreeMenu=l}),e("skylark-domx-plugins-menus/popup-menu",["skylark-langx/langx","skylark-devices-keyboard/keys","skylark-domx-noder","skylark-domx-styler","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","skylark-domx-plugins-popups/popups","./menus","./menu"],function(e,t,s,i,n,a,l,o,r,c){"use strict";var u=c.inherit({klassName:"PopupMenu",pluginName:"lark.menus.popup",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},position:{my:"left top",at:"right top"},role:"menu",item:{classes:{base:"menu-item",active:"active",disabled:"disabled",wrapper:"menu-item-wrapper"},selector:"> *"},blur:null,focus:null,select:null},_construct:function(e,t){c.prototype._construct.call(this,e,t),this.element=this.$(),this.activeMenu=this.element,this.mouseHandled=!1,this.lastMousePosition={x:null,y:null},this.element.attr({role:this.options.role,tabIndex:0}),this.listenTo(this.element,{mousedown:function(e){e.preventDefault(),this._activateItem(e)},click:function(e){var t=n(e.target),i=n(s.active());!this.mouseHandled&&t.not(`.${this.options.item.classes.disable}`).length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),t.has(`.${this.options.submenu.classes.base}`).length?this.expand(e):!this.element.is(":focus")&&i.closest(`.${this.options.submenu.classes.base}`).length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(`.${this.options.submenu.classes.base}`).length&&clearTimeout(this.timer)))},mouseenter:"_activateItem",mousemove:"_activateItem"},`.${this.options.item.classes.base}`),this.listenTo(this.element,{mouseleave:"collapseAll",focus:function(e,t){var s=this.active||this._menuItems().first();t||this.focus(e,s)},blur:function(e){this._delay(function(){var t=!s.contains(this.element[0],s.active());t&&this.collapseAll(e)})},keydown:"_keydown"}),this.listenTo(this.element,"mouseleave",`.${this.options.submenu.classes.base}`,"collapseAll"),this.listenTo(n(document),{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e,!0),this.mouseHandled=!1}})},_activateItem:function(e){if(!this.previousFilter&&(e.clientX!==this.lastMousePosition.x||e.clientY!==this.lastMousePosition.y)){this.lastMousePosition={x:e.clientX,y:e.clientY};var t=n(e.target).closest(`.${this.options.item.classes.base}`),s=n(e.currentTarget);t[0]===s[0]&&(s.is(`.${this.options.item.classes.active}`)||(s.siblings().children(`.${this.options.item.classes.active}`).removeClass(this.options.item.classes.active),this.focus(e,s)))}},_keydown:function(e){var s,i,n,a,l=!0;switch(e.keyCode){case t.PAGE_UP:this.previousPage(e);break;case t.PAGE_DOWN:this.nextPage(e);break;case t.HOME:this._move("first","first",e);break;case t.END:this._move("last","last",e);break;case t.UP:this.previous(e);break;case t.DOWN:this.next(e);break;case t.LEFT:this.collapse(e);break;case t.RIGHT:this.active&&!this.active.is(`.${this.options.item.classes.disabled}`)&&this.expand(e);break;case t.ENTER:case t.SPACE:this._activate(e);break;case t.ESC:this.collapse(e);break;default:l=!1,i=this.previousFilter||"",a=!1,n=e.keyCode>=96&&e.keyCode<=105?(e.keyCode-96).toString():String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===i?a=!0:n=i+n,s=this._filterMenuItems(n),(s=a&&-1!==s.index(this.active.next())?this.active.nextAll(`.${this.options.item.classes.base}`):s).length||(n=String.fromCharCode(e.keyCode),s=this._filterMenuItems(n)),s.length?(this.focus(e,s),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}l&&e.preventDefault()},_activate:function(e){this.active&&!this.active.is(`.${this.options.item.classes.disabled}`)&&(this.active.children("[aria-haspopup='true']").length?this.expand(e):this.select(e))},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(e,t){var s,i;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),(i=this.active.children(`.${this.options.item.classes.wrapper}`)).addClass(this.options.item.classes.active),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),this.active.parent().closest(`.${this.options.item.classes.base}`).children(`.${this.options.item.classes.wrapper}`).addClass(this.options.item.classes.active),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(s=t.children(`.${this.options.submenu.classes.base}`)).length&&e&&/^mouse/.test(e.type)&&this._startOpening(s),this.activeMenu=t.parent(),this.trigger("focus",{item:t})},_scrollIntoView:function(e){var t,s,n,a,l,o;this._hasScroll()&&(t=parseFloat(i.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(i.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-t-s,a=this.activeMenu.scrollTop(),l=this.activeMenu.height(),o=e.outerHeight(),n<0?this.activeMenu.scrollTop(a+n):n+o>l&&this.activeMenu.scrollTop(a+n-l+o))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children(`.${this.options.item.classes.wrapper}`).removeClass(this.options.item.classes.active),this.trigger("blur",{item:this.active}),this.active=null)},_startOpening:function(e){clearTimeout(this.timer),this.timer=this._delay(function(){this._close(),this._open(e)},this.delay)},_open:function(t){var s=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(`.${this.options.submenu.classes.base}`).not(t.parents(`.${this.options.submenu.classes.base}`)).hide().attr("aria-hidden","true"),o.open(t.attr("aria-expanded","true"),{position:s})},collapseAll:function(e,t){clearTimeout(this.timer),this.timer=this._delay(function(){var s=t?this.element:n(e&&e.target).closest(this.element.find(`.${this.options.submenu.classes.base}`));s.length||(s=this.element),this._close(s),this.blur(e),s.find(`.${this.options.item.classes.active}`).removeClass(this.options.item.classes.active),this.activeMenu=s},t?0:this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),o.close(e.find(`.${this.options.submenu.classes.base}`).attr("aria-expanded","false"))},_closeOnDocumentClick:function(e){return!n(e.target).closest(`.${this.options.submenu.classes.base}`).length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(`.${this.options.item.classes.base}`,this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this._menuItems(this.active.children(`.${this.options.submenu.classes.base}`)).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(`.${this.options.item.classes.base}`).length},isLastItem:function(){return this.active&&!this.active.nextAll(`.${this.options.item.classes.base}`).length},_menuItems:function(e){return(e||this.element).find(this.options.items).filter(`.${this.options.item.classes.base}`)},_move:function(e,t,s){var i;this.active&&(i="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](`.${this.options.item.classes.base}`).last():this.active[e+"All"](`.${this.options.item.classes.base}`).first()),i&&i.length&&this.active||(i=this._menuItems(this.activeMenu)[t]()),this.focus(s,i)},nextPage:function(e){var t,s,i;this.active?this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,i=this.element.height(),this.active.nextAll(`.${this.options.item.classes.base}`).each(function(){return(t=n(this)).offset().top-s-i<0}),this.focus(e,t)):this.focus(e,this._menuItems(this.activeMenu)[this.active?"last":"first"]())):this.next(e)},previousPage:function(e){var t,s,i;this.active?this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,i=this.element.height(),this.active.prevAll(`.${this.options.item.classes.base}`).each(function(){return(t=n(this)).offset().top-s+i>0}),this.focus(e,t)):this.focus(e,this._menuItems(this.activeMenu).first())):this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||n(e.target).closest(`.${this.options.item.classes.base}`);var t={item:this.active};this.active.has(`.${this.options.submenu.classes.base}`).length||this.collapseAll(e,!0),this.trigger("select",t)},_filterMenuItems:function(t){var s=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),i=new RegExp("^"+s,"i");return this.activeMenu.find(this.options.items).filter(`.${this.options.item.classes.base}`).filter(function(){return i.test(e.trim(n(this).children(`.${this.options.item.classes.wrapper}`).text()))})}});return l.register(u),r.PopupMenu=u}),e("skylark-domx-plugins-menus/main",["./menus","./accordion-menu","./cascade-menu","./nav-menu","./tree-menu","./popup-menu"],function(e){return e}),e("skylark-domx-plugins-menus",["skylark-domx-plugins-menus/main"],function(e){return e})}(s),!i){var l=require("skylark-langx-ns");n?module.exports=l:t.skylarkjs=l}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-domx-plugins-menus.js.map
