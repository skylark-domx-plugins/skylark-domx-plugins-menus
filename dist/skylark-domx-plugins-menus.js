/**
 * skylark-domx-plugins-menus - The skylark menu plugin library.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-plugins-menus/
 * @license MIT
 */
(function(factory,globals,define,require) {
  var isAmd = (typeof define === 'function' && define.amd),
      isCmd = (!isAmd && typeof exports !== 'undefined');

  if (!isAmd && !define) {
    var map = {};
    function absolute(relative, base) {
        if (relative[0]!==".") {
          return relative;
        }
        var stack = base.split("/"),
            parts = relative.split("/");
        stack.pop(); 
        for (var i=0; i<parts.length; i++) {
            if (parts[i] == ".")
                continue;
            if (parts[i] == "..")
                stack.pop();
            else
                stack.push(parts[i]);
        }
        return stack.join("/");
    }
    define = globals.define = function(id, deps, factory) {
        if (typeof factory == 'function') {
            map[id] = {
                factory: factory,
                deps: deps.map(function(dep){
                  return absolute(dep,id);
                }),
                resolved: false,
                exports: null
            };
            require(id);
        } else {
            map[id] = {
                factory : null,
                resolved : true,
                exports : factory
            };
        }
    };
    require = globals.require = function(id) {
        if (!map.hasOwnProperty(id)) {
            throw new Error('Module ' + id + ' has not been defined');
        }
        var module = map[id];
        if (!module.resolved) {
            var args = [];

            module.deps.forEach(function(dep){
                args.push(require(dep));
            })

            module.exports = module.factory.apply(globals, args) || null;
            module.resolved = true;
        }
        return module.exports;
    };
  }
  
  if (!define) {
     throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");
  }

  factory(define,require);

  if (!isAmd) {
    var skylarkjs = require("skylark-langx-ns");

    if (isCmd) {
      module.exports = skylarkjs;
    } else {
      globals.skylarkjs  = skylarkjs;
    }
  }

})(function(define,require) {

define("skylark-domx-plugins-menus/menus",["skylark-domx-plugins-base"],function(e){return e.menus={}}),define("skylark-domx-plugins-menus/menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus"],function(t,i,e,n,s){"use strict";var a=n.Plugin.inherit({klassName:"Menu",pluginName:"lark.menus.menu",options:{template:"",classes:{base:"lark-menu"},selectors:{container:null},item:{templates:{general:'<li class="menu-item"><a href="#" class="link"><%= title %></a></li>',separator:"",hasChildren:'<li class="menu-item hasChildren"><a href="#" class="link"><%= title %></a><ul class="submenu"></ul>'},classes:{base:"menu-item",active:"active",hasChildren:"hasChildren"},selectors:{general:"li",hasChildren:":has(ul)"}},submenu:{template:"<ul></ul>",classes:{base:"submenu"},selectors:{children:"> ul",descendant:"ul"}},data:{},onAction:null},_construct:function(e,s){n.Plugin.prototype._construct.call(this,e,s),this._$container=this.$(this.options.selectors.container),this.options.onAction&&this.listenTo(this._$container,"click","."+this.options.item.classes.base,e=>{e=i(e.currentTarget).data("item");this.options.onAction(e)})},renderMenuItemHtml:function(e){var s;return this._renderItemHtml||(s=this.options.item.template,t.isString(s)?this._renderItemHtml=t.template(s):t.isFunction(s)&&(this._renderItemHtml=s)),this._renderItemHtml(e)},renderGeneralMenuItem:function(e){var s;return this._renderGeneralItemHtml||(s=this.options.item.templates.general,t.isString(s)?this._renderGeneralItemHtml=t.template(s):t.isFunction(s)&&(this._renderGeneralItemHtml=s)),i(this._renderGeneralItemHtml(e))},renderHasChildrenMenuItem:function(e){var s;return this._renderHasChildrenItemHtml||(s=this.options.item.templates.hasChildren,t.isString(s)?this._renderHasChildrenItemHtml=t.template(s):t.isFunction(s)&&(this._renderHasChildrenItemHtml=s)),i(this._renderHasChildrenItemHtml(e))}});return n.register(a),s.Menu=a}),define("skylark-domx-plugins-menus/accordion-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu"],function(e,s,t,i,n,a){"use strict";var l=a.inherit({klassName:"AccordionMenu",pluginName:"lark.menus.accordion",_construct:function(e,s){a.prototype._construct.call(this,e,s),t.multitier(e,{togglable:!0,classes:{active:this.options.item.classes.active},selectors:{item:this.options.item.selectors.general,sublist:this.options.submenu.selectors.descendant,hasSublist:this.options.item.selectors.hasChildren},multiExpand:!1})}});return i.register(l),n.AccordionMenu=l}),define("skylark-domx-plugins-menus/cascade-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu"],function(e,s,t,i,n,a){"use strict";var l=a.inherit({klassName:"CascadeMenu",pluginName:"lark.menus.cascade",_construct:function(e,s){a.prototype._construct.call(this,e,s),t.multitier(e,{togglable:!0,classes:{active:this.options.item.classes.active},selectors:{item:this.options.item.selectors.general,sublist:this.options.submenu.selectors.descendant,hasSublist:this.options.item.selectors.hasChildren},multiExpand:!1})}});return i.register(l),n.CascadeMenu=l}),define("skylark-domx-plugins-menus/mega-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu"],function(u,m,e,s,t,i){"use strict";var n=i.inherit({klassName:"MegaMenu",pluginName:"lark.menus.mega",options:{menuBehaviour:"click",stickyHeader:!0,caret:!1,caretArrows:[{up:"caret-up",down:"caret-down",upUrl:"",downUrl:""}],highlighter:!0,followingHighlighter:!1,highlightColor:"",textHighlighter:!1,textHighlighterColor:"",animation:!1,animationClass:""},_construct:function(e,s){i.prototype._construct.call(this,e,s);let n=this.options;n.selector;var a=m(".main-links ul li a"),l=m(".menu-dropdown .menu-item-wrapper"),o=[],r=[],c=(m("#"+l.attr("id")),this.options.caretArrows[0].up),h=this.options.caretArrows[0].down;!1===n.stickyHeader?m(".mega-menu").removeClass("sticky-header"):m(".mega-menu").addClass("sticky-header"),!0===n.caret&&(c=n.caretArrows[0].up,h=n.caretArrows[0].down),(n.caretArrows[0].up||n.caretArrows[0].down)&&(n.caretArrows[0].upUrl=null,n.caretArrows[0].downUrl=null),m("a[data-submenu]").append('<span class="caret '+h+'"></span>'),!0===n.caret&&""!==n.caretArrows[0].downUrl&&(m(".mega-menu span.caret").removeClass("undefined"),m(".mega-menu span.caret").addClass("caret-img down"),m(".mega-menu span.caret.caret-img.down").css({"background-image":"url("+n.caretArrows[0].downUrl+")"})),m(`<style>
            .mega-menu .main-links ul li a:hover{
              border-color:`+n.highlightColor+`}
          </style>`).appendTo("head"),a.on(n.menuBehaviour,function(){a.removeClass("highlight"),a.css({"border-color":""})}),""===n.menuBehaviour&&(n.menuBehaviour="click"),a.each(function(t){var i=m(this).attr("data-submenu");o.push(m(this).attr("data-submenu")),m(this).on(n.menuBehaviour,function(){var e=u.inArray(i,r),s=m(this).find(".caret.caret-img");a.find("span").removeClass(c),a.find("span").addClass(h),o[t]!=r[e]||m(l[e]).hasClass("active")?(m(l[e]).removeClass("active"),m(this).find("span").removeClass(c),m(this).find("span").addClass(h)):(l.removeClass("active"),m(l[e]).addClass("active"),m(this).find("span").removeClass(h),m(this).find("span").addClass(c)),m(".menu-dropdown").find(".menu-item-wrapper").hasClass("active")&&(m(".mega-menu span.caret").addClass("down"),m(".mega-menu span.caret").css({"background-image":"url("+n.caretArrows[0].downUrl+")"})),s.hasClass("down")?(s.removeClass("down"),s.addClass("up"),s.css({"background-image":"url("+n.caretArrows[0].upUrl+")"})):(s.removeClass("up"),s.addClass("down"),s.css({"background-image":"url("+n.caretArrows[0].downUrl+")"})),(a.find("span").hasClass("caret-up")||m(this).find("span").hasClass("up")&&!m(this).hasClass("highlight"))&&(m(this).addClass("highlight"),m(this).css({"border-color":n.highlightColor})),l.hasClass("dropdown")&&m("#"+r[e]+".dropdown").css({left:m(this).offset().left})})}),!0===n.followingHighlighter&&(m(".main-links ul").append('<div class="follow-highlighter"></div>'),a.mouseover(function(e,s){e.pageX,m(this).offset().left,m(this).innerWidth();m(".follow-highlighter").css({display:"block"}),m(".main-links ul").addClass("follow-highlighter-enabled"),m(".follow-highlighter").css({width:m(this).innerWidth(),left:m(this).offset().left,"background-color":n.highlightColor})})),m(".main-links ul").each(function(){m(this).mouseleave(function(){m(".main-links ul").removeClass("follow-highlighter-enabled"),m(".follow-highlighter").css({display:"none",left:m(a[0]).offset().left})})}),!1===n.highlighter&&(m(".main-links").addClass("disable-highlighter"),m(".follow-highlighter").remove()),!0===n.textHighlighter&&m(".main-links").addClass("text-highlighter"),n.textHighlighterColor&&m("style").append(`.mega-menu .text-highlighter.main-links ul li a:hover{
            color:`+n.textHighlighterColor+"}"),l.each(function(e){r.push(m(l[e]).attr("id"))}),!0===n.animation&&l.addClass(n.animationClass),m(".mobile-nav-icon a").click(function(){m(".follow-highlighter").remove(),m(".main-links").hasClass("active")?(m(".main-links").removeClass("active"),m(".menu-dropdown").hide()):(m(".main-links").addClass("active"),m(".menu-dropdown").show())}),m(".menu-item-wrapper").prepend('<a href="#" class="back-link">Back</a>'),m(window).resize(function(){m(window).width()<768?m(".mega-menu").hasClass("sticky-header")&&(m(".mega-menu").addClass("responsive-menu"),m(".main-links").css({"margin-top":m(".mobile-nav-icon").outerHeight()+"px"})):m(".main-links").css({"margin-top":"0px"})})}});return s.register(n),t.MegaMenu=n}),define("skylark-domx-plugins-menus/nav-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu"],function(e,s,t,i,n,a){"use strict";var l=a.inherit({klassName:"NavMenu",pluginName:"lark.menus.nav",options:{item:{templates:{}}},_construct:function(e,s){a.prototype._construct.call(this,e,s),this.options.data.items&&this.resetItems(this.options.data.items),t.multitier(e,{togglable:!1,classes:{active:this.options.item.classes.active},selectors:{item:this.options.item.selectors.general,sublist:this.options.submenu.selectors.descendant,hasSublist:this.options.item.selectors.hasChildren},multiExpand:!1})},resetItems:function(e){let n=this;let s=this.$(this.options.selectors.container);e.forEach(e=>{!function t(e,s){let i;if((i=e.children?n.renderHasChildrenMenuItem(e):n.renderGeneralMenuItem(e)).data("item",e),s.append(i),e.children){let s=i.find(n.options.submenu.selectors.children);e.children.forEach(e=>{t(e,s)})}}(e,s)})}});return i.register(l),n.NavMenu=l}),define("skylark-domx-plugins-menus/tree-menu",["skylark-langx/langx","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","./menus","./menu","skylark-domx-plugins-toggles"],function(t,e,i,s,n,a){"use strict";var l=a.inherit({klassName:"Tree",pluginName:"lark.menus.tree",_construct:function(e,s){a.prototype._construct.call(this,e,s),i.multitier(e,t.mixin({hide:function(e){e.plugin("lark.toggles.collapse").hide()},toggle:function(e){e.plugin("lark.toggles.collapse").toggle()}},this.options))}});return s.register(l),n.TreeMenu=l}),define("skylark-domx-plugins-menus/popup-menu",["skylark-langx/langx","skylark-devices-keyboard/keys","skylark-domx-noder","skylark-domx-styler","skylark-domx-query","skylark-domx-lists","skylark-domx-plugins-base","skylark-domx-plugins-popups/popups","./menus","./menu"],function(t,a,i,n,l,e,s,o,r,c){"use strict";var h=c.inherit({klassName:"PopupMenu",pluginName:"lark.menus.popup",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},position:{my:"left top",at:"right top"},role:"menu",item:{classes:{base:"menu-item",active:"active",disabled:"disabled",wrapper:"menu-item-wrapper"},selector:"> *"},blur:null,focus:null,select:null},_construct:function(e,s){c.prototype._construct.call(this,e,s),this.element=this.$(),this.activeMenu=this.element,this.mouseHandled=!1,this.lastMousePosition={x:null,y:null},this.element.attr({role:this.options.role,tabIndex:0}),this.listenTo(this.element,{mousedown:function(e){e.preventDefault(),this._activateItem(e)},click:function(e){var s=l(e.target),t=l(i.active());!this.mouseHandled&&s.not("."+this.options.item.classes.disable).length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),s.has("."+this.options.submenu.classes.base).length?this.expand(e):!this.element.is(":focus")&&t.closest("."+this.options.submenu.classes.base).length&&(this.element.trigger("focus",[!0]),this.active)&&1===this.active.parents("."+this.options.submenu.classes.base).length&&clearTimeout(this.timer))},mouseenter:"_activateItem",mousemove:"_activateItem"},"."+this.options.item.classes.base),this.listenTo(this.element,{mouseleave:"collapseAll",focus:function(e,s){var t=this.active||this._menuItems().first();s||this.focus(e,t)},blur:function(e){this._delay(function(){i.contains(this.element[0],i.active())||this.collapseAll(e)})},keydown:"_keydown"}),this.listenTo(this.element,"mouseleave","."+this.options.submenu.classes.base,"collapseAll"),this.listenTo(l(document),{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e,!0),this.mouseHandled=!1}})},_activateItem:function(e){var s,t;this.previousFilter||e.clientX===this.lastMousePosition.x&&e.clientY===this.lastMousePosition.y||(this.lastMousePosition={x:e.clientX,y:e.clientY},s=l(e.target).closest("."+this.options.item.classes.base),t=l(e.currentTarget),s[0]!==t[0])||t.is("."+this.options.item.classes.active)||(t.siblings().children("."+this.options.item.classes.active).removeClass(this.options.item.classes.active),this.focus(e,t))},_keydown:function(e){var s,t,i,n=!0;switch(e.keyCode){case a.PAGE_UP:this.previousPage(e);break;case a.PAGE_DOWN:this.nextPage(e);break;case a.HOME:this._move("first","first",e);break;case a.END:this._move("last","last",e);break;case a.UP:this.previous(e);break;case a.DOWN:this.next(e);break;case a.LEFT:this.collapse(e);break;case a.RIGHT:this.active&&!this.active.is("."+this.options.item.classes.disabled)&&this.expand(e);break;case a.ENTER:case a.SPACE:this._activate(e);break;case a.ESC:this.collapse(e);break;default:s=this.previousFilter||"",i=n=!1,t=96<=e.keyCode&&e.keyCode<=105?(e.keyCode-96).toString():String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),t===s?i=!0:t=s+t,s=this._filterMenuItems(t),(s=i&&-1!==s.index(this.active.next())?this.active.nextAll("."+this.options.item.classes.base):s).length||(t=String.fromCharCode(e.keyCode),s=this._filterMenuItems(t)),s.length?(this.focus(e,s),this.previousFilter=t,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}n&&e.preventDefault()},_activate:function(e){this.active&&!this.active.is("."+this.options.item.classes.disabled)&&(this.active.children("[aria-haspopup='true']").length?this.expand(e):this.select(e))},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(e,s){var t;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(s),this.active=s.first(),(t=this.active.children("."+this.options.item.classes.wrapper)).addClass(this.options.item.classes.active),this.options.role&&this.element.attr("aria-activedescendant",t.attr("id")),this.active.parent().closest("."+this.options.item.classes.base).children("."+this.options.item.classes.wrapper).addClass(this.options.item.classes.active),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(t=s.children("."+this.options.submenu.classes.base)).length&&e&&/^mouse/.test(e.type)&&this._startOpening(t),this.activeMenu=s.parent(),this.trigger("focus",{item:s})},_scrollIntoView:function(e){var s,t,i;this._hasScroll()&&(s=parseFloat(n.css(this.activeMenu[0],"borderTopWidth"))||0,t=parseFloat(n.css(this.activeMenu[0],"paddingTop"))||0,s=e.offset().top-this.activeMenu.offset().top-s-t,t=this.activeMenu.scrollTop(),i=this.activeMenu.height(),e=e.outerHeight(),s<0?this.activeMenu.scrollTop(t+s):i<s+e&&this.activeMenu.scrollTop(t+s-i+e))},blur:function(e,s){s||clearTimeout(this.timer),this.active&&(this.active.children("."+this.options.item.classes.wrapper).removeClass(this.options.item.classes.active),this.trigger("blur",{item:this.active}),this.active=null)},_startOpening:function(e){clearTimeout(this.timer),this.timer=this._delay(function(){this._close(),this._open(e)},this.delay)},_open:function(e){var s=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find("."+this.options.submenu.classes.base).not(e.parents("."+this.options.submenu.classes.base)).hide().attr("aria-hidden","true"),o.open(e.attr("aria-expanded","true"),{position:s})},collapseAll:function(s,t){clearTimeout(this.timer),this.timer=this._delay(function(){var e=t?this.element:l(s&&s.target).closest(this.element.find("."+this.options.submenu.classes.base));e.length||(e=this.element),this._close(e),this.blur(s),e.find("."+this.options.item.classes.active).removeClass(this.options.item.classes.active),this.activeMenu=e},t?0:this.delay)},_close:function(e){e=e||(this.active?this.active.parent():this.element),o.close(e.find("."+this.options.submenu.classes.base).attr("aria-expanded","false"))},_closeOnDocumentClick:function(e){return!l(e.target).closest("."+this.options.submenu.classes.base).length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var s=this.active&&this.active.parent().closest("."+this.options.item.classes.base,this.element);s&&s.length&&(this._close(),this.focus(e,s))},expand:function(e){var s=this.active&&this._menuItems(this.active.children("."+this.options.submenu.classes.base)).first();s&&s.length&&(this._open(s.parent()),this._delay(function(){this.focus(e,s)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll("."+this.options.item.classes.base).length},isLastItem:function(){return this.active&&!this.active.nextAll("."+this.options.item.classes.base).length},_menuItems:function(e){return(e||this.element).find(this.options.items).filter("."+this.options.item.classes.base)},_move:function(e,s,t){var i;(i=this.active?"first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"]("."+this.options.item.classes.base).last():this.active[e+"All"]("."+this.options.item.classes.base).first():i)&&i.length&&this.active||(i=this._menuItems(this.activeMenu)[s]()),this.focus(t,i)},nextPage:function(e){var s,t,i;this.active?this.isLastItem()||(this._hasScroll()?(t=this.active.offset().top,i=this.element.height(),this.active.nextAll("."+this.options.item.classes.base).each(function(){return(s=l(this)).offset().top-t-i<0}),this.focus(e,s)):this.focus(e,this._menuItems(this.activeMenu)[this.active?"last":"first"]())):this.next(e)},previousPage:function(e){var s,t,i;this.active?this.isFirstItem()||(this._hasScroll()?(t=this.active.offset().top,i=this.element.height(),this.active.prevAll("."+this.options.item.classes.base).each(function(){return 0<(s=l(this)).offset().top-t+i}),this.focus(e,s)):this.focus(e,this._menuItems(this.activeMenu).first())):this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||l(e.target).closest("."+this.options.item.classes.base);var s={item:this.active};this.active.has("."+this.options.submenu.classes.base).length||this.collapseAll(e,!0),this.trigger("select",s)},_filterMenuItems:function(e){var e=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=new RegExp("^"+e,"i");return this.activeMenu.find(this.options.items).filter("."+this.options.item.classes.base).filter(function(){return s.test(t.trim(l(this).children("."+this.options.item.classes.wrapper).text()))})}});return s.register(h),r.PopupMenu=h}),define("skylark-domx-plugins-menus/main",["./menus","./accordion-menu","./cascade-menu","./mega-menu","./nav-menu","./tree-menu","./popup-menu"],function(e){return e}),define("skylark-domx-plugins-menus",["skylark-domx-plugins-menus/main"],function(e){return e});
},this,define,require);
//# sourceMappingURL=sourcemaps/skylark-domx-plugins-menus.js.map
