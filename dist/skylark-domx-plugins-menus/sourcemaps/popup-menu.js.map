{"version":3,"sources":["popup-menu.js"],"names":["define","langx","keys","noder","styler","$","lists","plugins","menus","Menu","PopupMenu","inherit","klassName","pluginName","delay","options","icons","submenu","position","my","at","role","item","classes","base","active","disabled","selector","blur","focus","select","_construct","elm","prototype","call","this","element","activeMenu","mouseHandled","lastMousePosition","x","y","attr","tabIndex","listenTo","mousedown .ui-menu-item","event","preventDefault","_activateItem","click .ui-menu-item","target","not","length","isPropagationStopped","has","expand","is","closest","trigger","parents","clearTimeout","timer","mouseenter .ui-menu-item","mousemove .ui-menu-item","mouseleave","mouseleave .ui-menu","keepActiveItem","_menuItems","first","_delay","includes","collapseAll","keydown","document","click","_closeOnDocumentClick","previousFilter","clientX","clientY","actualTarget","currentTarget","siblings","children","removeClass","_destroy","submenus","find","removeAttr","removeUniqueId","addBack","show","each","elem","data","remove","_keydown","match","prev","character","skip","keyCode","PAGE_UP","previousPage","PAGE_DOWN","nextPage","HOME","_move","END","UP","previous","DOWN","next","LEFT","collapse","RIGHT","ENTER","SPACE","_activate","ESC","toString","String","fromCharCode","filterTimer","_filterMenuItems","index","nextAll","refresh","items","newItems","newWrappers","that","icon","selectors","descendant","toggleClass","filter","hide","aria-hidden","aria-expanded","menu","submenuCaret","addClass","prepend","add","_isDivider","_itemRole","listbox","nested","focused","type","_scrollIntoView","parent","_close","test","_startOpening","borderTop","paddingTop","offset","scroll","elementHeight","itemHeight","_hasScroll","parseFloat","css","top","scrollTop","height","outerHeight","fromFocus","_open","extend","of","all","currentMenu","startMenu","text","newItem","isFirstItem","prevAll","isLastItem","direction","last","prop","ui","escapedCharacter","replace","regex","RegExp","trim","register"],"mappings":"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","file":"../popup-menu.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-devices-keyboard/keys\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-styler\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-domx-lists\",\r\n  \"skylark-domx-plugins-base\",\r\n  \"./menus\",\r\n  \"./menu\"\r\n],function(langx,keys,noder,styler, $,lists,plugins,menus,Menu){\r\n  'use strict'\r\n\r\n  \tvar PopupMenu = Menu.inherit({\r\n\r\n    \tklassName : \"PopupMenu\",\r\n\r\n    \tpluginName : \"lark.menus.popup\",\r\n\r\n\t\tdelay: 300,\r\n\t\toptions: {\r\n\t\t\ticons: {\r\n\t\t\t\tsubmenu: \"ui-icon-caret-1-e\"\r\n\t\t\t},\r\n\t\t\t///items: \"> *\",\r\n\t\t\t///menus: \"ul\",\r\n\t\t\tposition: {\r\n\t\t\t\tmy: \"left top\",\r\n\t\t\t\tat: \"right top\"\r\n\t\t\t},\r\n\r\n\t\t\trole: \"menu\",\r\n\r\n\r\n\t\t\titem : {\r\n\t\t\t\tclasses : {\r\n\t\t\t\t\tbase : \"ui-menu-item\",\r\n          \t\t\tactive : \"ui-state-active\",\r\n          \t\t\tdisabled : \"ui-state-disabled\"\r\n\t\t\t\t},\r\n\t\t\t\tselector : \"> *\"\r\n\t\t\t},\r\n\r\n\t\t\t// Callbacks\r\n\t\t\tblur: null,\r\n\t\t\tfocus: null,\r\n\t\t\tselect: null\r\n\t\t},\r\n\r\n    \t_construct : function(elm,options) {\r\n        \tMenu.prototype._construct.call(this,elm,options);\r\n\t\t\tthis.element = this.$();\r\n\r\n\t\t\tthis.activeMenu = this.element;\r\n\r\n\t\t\t// Flag used to prevent firing of the click handler\r\n\t\t\t// as the event bubbles up through nested menus\r\n\t\t\tthis.mouseHandled = false;\r\n\t\t\tthis.lastMousePosition = { x: null, y: null };\r\n\t\t\tthis.element\r\n\t\t\t\t.attr( {\r\n\t\t\t\t\trole: this.options.role,\r\n\t\t\t\t\ttabIndex: 0\r\n\t\t\t\t} );\r\n\r\n\t\t\tthis.listenTo(this.element, {\r\n\r\n\t\t\t\t// Prevent focus from sticking to links inside menu after clicking\r\n\t\t\t\t// them (focus should always stay on UL during navigation).\r\n\t\t\t\t\"mousedown .ui-menu-item\": function( event ) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\t\tthis._activateItem( event );\r\n\t\t\t\t},\r\n\t\t\t\t\"click .ui-menu-item\": function( event ) {\r\n\t\t\t\t\tvar target = $( event.target );\r\n\t\t\t\t\t//var active = $( $.ui.safeActiveElement( this.document[ 0 ] ) );\r\n\t\t\t\t\tvar active = $(noder.active());\r\n\t\t\t\t\tif ( !this.mouseHandled && target.not( \".ui-state-disabled\" ).length ) {\r\n\t\t\t\t\t\tthis.select( event );\r\n\r\n\t\t\t\t\t\t// Only set the mouseHandled flag if the event will bubble, see #9469.\r\n\t\t\t\t\t\tif ( !event.isPropagationStopped() ) {\r\n\t\t\t\t\t\t\tthis.mouseHandled = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Open submenu on click\r\n\t\t\t\t\t\tif ( target.has( \".ui-menu\" ).length ) {\r\n\t\t\t\t\t\t\tthis.expand( event );\r\n\t\t\t\t\t\t} else if ( !this.element.is( \":focus\" ) &&\r\n\t\t\t\t\t\t\t\tactive.closest( \".ui-menu\" ).length ) {\r\n\r\n\t\t\t\t\t\t\t// Redirect focus to the menu\r\n\t\t\t\t\t\t\tthis.element.trigger( \"focus\", [ true ] );\r\n\r\n\t\t\t\t\t\t\t// If the active item is on the top level, let it stay active.\r\n\t\t\t\t\t\t\t// Otherwise, blur the active item since it is no longer visible.\r\n\t\t\t\t\t\t\tif ( this.active && this.active.parents( \".ui-menu\" ).length === 1 ) {\r\n\t\t\t\t\t\t\t\tclearTimeout( this.timer );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"mouseenter .ui-menu-item\": \"_activateItem\",\r\n\t\t\t\t\"mousemove .ui-menu-item\": \"_activateItem\",\r\n\t\t\t\t\"mouseleave\": \"collapseAll\",\r\n\t\t\t\t\"mouseleave .ui-menu\": \"collapseAll\",\r\n\t\t\t\t\"focus\": function( event, keepActiveItem ) {\r\n\r\n\t\t\t\t\t// If there's already an active item, keep it active\r\n\t\t\t\t\t// If not, activate the first item\r\n\t\t\t\t\tvar item = this.active || this._menuItems().first();\r\n\r\n\t\t\t\t\tif ( !keepActiveItem ) {\r\n\t\t\t\t\t\tthis.focus( event, item );\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"blur\": function( event ) {\r\n\t\t\t\t\tthis._delay( function() {\r\n\t\t\t\t\t\tvar notContained = !langx.includes(\r\n\t\t\t\t\t\t\tthis.element[ 0 ],\r\n\t\t\t\t\t\t\t//$.ui.safeActiveElement( this.document[ 0 ] )\r\n\t\t\t\t\t\t\tnoder.active()\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tif ( notContained ) {\r\n\t\t\t\t\t\t\tthis.collapseAll( event );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} );\r\n\t\t\t\t},\r\n\t\t\t\t\"keydown\": \"_keydown\"\r\n\t\t\t} );\r\n\r\n\t\t\t///this.refresh();\r\n\r\n\t\t\t// Clicks outside of a menu collapse any open menus\r\n\t\t\tthis.listenTo( $(document), {\r\n\t\t\t\tclick: function( event ) {\r\n\t\t\t\t\tif ( this._closeOnDocumentClick( event ) ) {\r\n\t\t\t\t\t\tthis.collapseAll( event, true );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Reset the mouseHandled flag\r\n\t\t\t\t\tthis.mouseHandled = false;\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t},\r\n\r\n\t\t_activateItem: function( event ) {\r\n\r\n\t\t\t// Ignore mouse events while typeahead is active, see #10458.\r\n\t\t\t// Prevents focusing the wrong item when typeahead causes a scroll while the mouse\r\n\t\t\t// is over an item in the menu\r\n\t\t\tif ( this.previousFilter ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If the mouse didn't actually move, but the page was scrolled, ignore the event (#9356)\r\n\t\t\tif ( event.clientX === this.lastMousePosition.x &&\r\n\t\t\t\t\tevent.clientY === this.lastMousePosition.y ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.lastMousePosition = {\r\n\t\t\t\tx: event.clientX,\r\n\t\t\t\ty: event.clientY\r\n\t\t\t};\r\n\r\n\t\t\tvar actualTarget = $( event.target ).closest( \".ui-menu-item\" ),\r\n\t\t\t\ttarget = $( event.currentTarget );\r\n\r\n\t\t\t// Ignore bubbled events on parent items, see #11641\r\n\t\t\tif ( actualTarget[ 0 ] !== target[ 0 ] ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If the item is already active, there's nothing to do\r\n\t\t\tif ( target.is(`.${this.options.item.classes.active}`) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove ui-state-active class from siblings of the newly focused menu item\r\n\t\t\t// to avoid a jump caused by adjacent elements both having a class with a border\r\n\t\t\t///this._removeClass( target.siblings().children( \".ui-state-active\" ),\r\n\t\t\t///\tnull, \"ui-state-active\" );\r\n\t\t\ttarget.siblings().children( `.${this.options.item.classes.active}` ).removeClass(this.options.item.classes.active);\r\n\t\t\tthis.focus( event, target );\r\n\t\t},\r\n\r\n\t\t_destroy: function() {\r\n\t\t\tvar items = this.element.find( \".ui-menu-item\" )\r\n\t\t\t\t\t.removeAttr( \"role aria-disabled\" ),\r\n\t\t\t\tsubmenus = items.children( \".ui-menu-item-wrapper\" )\r\n\t\t\t\t\t.removeUniqueId()\r\n\t\t\t\t\t.removeAttr( \"tabIndex role aria-haspopup\" );\r\n\r\n\t\t\t// Destroy (sub)menus\r\n\t\t\tthis.element\r\n\t\t\t\t.removeAttr( \"aria-activedescendant\" )\r\n\t\t\t\t.find( \".ui-menu\" ).addBack()\r\n\t\t\t\t\t.removeAttr( \"role aria-labelledby aria-expanded aria-hidden aria-disabled \" +\r\n\t\t\t\t\t\t\"tabIndex\" )\r\n\t\t\t\t\t.removeUniqueId()\r\n\t\t\t\t\t.show();\r\n\r\n\t\t\tsubmenus.children().each( function() {\r\n\t\t\t\tvar elem = $( this );\r\n\t\t\t\tif ( elem.data( \"ui-menu-submenu-caret\" ) ) {\r\n\t\t\t\t\telem.remove();\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t},\r\n\r\n\t\t_keydown: function( event ) {\r\n\t\t\tvar match, prev, character, skip,\r\n\t\t\t\tpreventDefault = true;\r\n\r\n\t\t\tswitch ( event.keyCode ) {\r\n\t\t\tcase keys.PAGE_UP:\r\n\t\t\t\tthis.previousPage( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.PAGE_DOWN:\r\n\t\t\t\tthis.nextPage( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.HOME:\r\n\t\t\t\tthis._move( \"first\", \"first\", event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.END:\r\n\t\t\t\tthis._move( \"last\", \"last\", event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.UP:\r\n\t\t\t\tthis.previous( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.DOWN:\r\n\t\t\t\tthis.next( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.LEFT:\r\n\t\t\t\tthis.collapse( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.RIGHT:\r\n\t\t\t\tif ( this.active && !this.active.is( \".ui-state-disabled\" ) ) {\r\n\t\t\t\t\tthis.expand( event );\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.ENTER:\r\n\t\t\tcase keys.SPACE:\r\n\t\t\t\tthis._activate( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.ESC:\r\n\t\t\t\tthis.collapse( event );\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tpreventDefault = false;\r\n\t\t\t\tprev = this.previousFilter || \"\";\r\n\t\t\t\tskip = false;\r\n\r\n\t\t\t\t// Support number pad values\r\n\t\t\t\tcharacter = event.keyCode >= 96 && event.keyCode <= 105 ?\r\n\t\t\t\t\t( event.keyCode - 96 ).toString() : String.fromCharCode( event.keyCode );\r\n\r\n\t\t\t\tclearTimeout( this.filterTimer );\r\n\r\n\t\t\t\tif ( character === prev ) {\r\n\t\t\t\t\tskip = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcharacter = prev + character;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmatch = this._filterMenuItems( character );\r\n\t\t\t\tmatch = skip && match.index( this.active.next() ) !== -1 ?\r\n\t\t\t\t\tthis.active.nextAll( \".ui-menu-item\" ) :\r\n\t\t\t\t\tmatch;\r\n\r\n\t\t\t\t// If no matches on the current filter, reset to the last character pressed\r\n\t\t\t\t// to move down the menu to the first item that starts with that character\r\n\t\t\t\tif ( !match.length ) {\r\n\t\t\t\t\tcharacter = String.fromCharCode( event.keyCode );\r\n\t\t\t\t\tmatch = this._filterMenuItems( character );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( match.length ) {\r\n\t\t\t\t\tthis.focus( event, match );\r\n\t\t\t\t\tthis.previousFilter = character;\r\n\t\t\t\t\tthis.filterTimer = this._delay( function() {\r\n\t\t\t\t\t\tdelete this.previousFilter;\r\n\t\t\t\t\t}, 1000 );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete this.previousFilter;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( preventDefault ) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_activate: function( event ) {\r\n\t\t\tif ( this.active && !this.active.is( \".ui-state-disabled\" ) ) {\r\n\t\t\t\tif ( this.active.children( \"[aria-haspopup='true']\" ).length ) {\r\n\t\t\t\t\tthis.expand( event );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.select( event );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\trefresh: function() {\r\n\t\t\tvar menus, items, newSubmenus, newItems, newWrappers,\r\n\t\t\t\tthat = this,\r\n\t\t\t\ticon = this.options.icons.submenu,\r\n\t\t\t\t//submenus = this.element.find( this.options.menus );\r\n\t\t\t\tsubmenus = this.element.find( this.options.submenu.selectors.descendant );\r\n\r\n\t\t\t///this._toggleClass( \"ui-menu-icons\", null, !!this.element.find( \".ui-icon\" ).length );\r\n\t\t\tthis.element.toggleClass(\"ui-menu-icons\",!!this.element.find( \".ui-icon\" ).length);\r\n\r\n\r\n\t\t\t// Initialize nested menus\r\n\t\t\tnewSubmenus = submenus.filter( \":not(.ui-menu)\" )\r\n\t\t\t\t.hide()\r\n\t\t\t\t.attr( {\r\n\t\t\t\t\trole: this.options.role,\r\n\t\t\t\t\t\"aria-hidden\": \"true\",\r\n\t\t\t\t\t\"aria-expanded\": \"false\"\r\n\t\t\t\t} )\r\n\t\t\t\t.each( function() {\r\n\t\t\t\t\tvar menu = $( this ),\r\n\t\t\t\t\t\titem = menu.prev(),\r\n\t\t\t\t\t\tsubmenuCaret = $( \"<span>\" ).data( \"ui-menu-submenu-caret\", true );\r\n\r\n\t\t\t\t\t///that._addClass( submenuCaret, \"ui-menu-icon\", \"ui-icon \" + icon );\r\n\t\t\t\t\tsubmenuCaret.addClass([\"ui-menu-icon\", \"ui-icon \" + icon]);\r\n\t\t\t\t\titem\r\n\t\t\t\t\t\t.attr( \"aria-haspopup\", \"true\" )\r\n\t\t\t\t\t\t.prepend( submenuCaret );\r\n\t\t\t\t\tmenu.attr( \"aria-labelledby\", item.attr( \"id\" ) );\r\n\t\t\t\t} );\r\n\r\n\t\t\t//this._addClass( newSubmenus, \"ui-menu\", \"ui-widget ui-widget-content ui-front\" );\r\n\t\t\tnewSubmenus.addClass([ \"ui-menu\", \"ui-widget\", \"ui-widget-content\", \"ui-front\"]);\r\n\r\n\t\t\tmenus = submenus.add( this.element );\r\n\t\t\t///items = menus.find( this.options.items );\r\n\t\t\titems = menus.find(this.options.item.selector);\r\n\r\n\t\t\t// Initialize menu-items containing spaces and/or dashes only as dividers\r\n\t\t\titems.not( \".ui-menu-item\" ).each( function() {\r\n\t\t\t\tvar item = $( this );\r\n\t\t\t\tif ( that._isDivider( item ) ) {\r\n\t\t\t\t\t///that._addClass( item, \"ui-menu-divider\", \"ui-widget-content\" );\r\n\t\t\t\t\titem.addClass([\"ui-menu-divider\", \"ui-widget-content\"] )\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\r\n\t\t\t// Don't refresh list items that are already adapted\r\n\t\t\tnewItems = items.not( \".ui-menu-item, .ui-menu-divider\" );\r\n\t\t\tnewWrappers = newItems.children()\r\n\t\t\t\t.not( \".ui-menu\" )\r\n\t\t\t\t\t.attr( {\r\n\t\t\t\t\t\ttabIndex: -1,\r\n\t\t\t\t\t\trole: this._itemRole()\r\n\t\t\t\t\t} );\r\n\t\t\tnewItems.addClass(\"ui-menu-item\");\r\n\t\t\tnewWrappers.addClass(\"ui-menu-item-wrapper\");\r\n\r\n\t\t\t// Add aria-disabled attribute to any disabled menu item\r\n\t\t\titems.filter( \".ui-state-disabled\" ).attr( \"aria-disabled\", \"true\" );\r\n\r\n\t\t\t// If the active item has been removed, blur the menu\r\n\t\t\tif ( this.active && !langx.includes( this.element[ 0 ], this.active[ 0 ] ) ) {\r\n\t\t\t\tthis.blur();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_itemRole: function() {\r\n\t\t\treturn {\r\n\t\t\t\tmenu: \"menuitem\",\r\n\t\t\t\tlistbox: \"option\"\r\n\t\t\t}[ this.options.role ];\r\n\t\t},\r\n\r\n\t\tfocus: function( event, item ) {\r\n\t\t\tvar nested, focused, activeParent;\r\n\t\t\tthis.blur( event, event && event.type === \"focus\" );\r\n\r\n\t\t\tthis._scrollIntoView( item );\r\n\r\n\t\t\tthis.active = item.first();\r\n\r\n\t\t\tfocused = this.active.children( \".ui-menu-item-wrapper\" );\r\n\t\t\t///this._addClass( focused, null, \"ui-state-active\" );\r\n\t\t\tfocused.addClass(this.options.item.classes.active);\r\n\r\n\t\t\t// Only update aria-activedescendant if there's a role\r\n\t\t\t// otherwise we assume focus is managed elsewhere\r\n\t\t\tif ( this.options.role ) {\r\n\t\t\t\tthis.element.attr( \"aria-activedescendant\", focused.attr( \"id\" ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Highlight active parent menu item, if any\r\n\t\t\tactiveParent = this.active\r\n\t\t\t\t.parent()\r\n\t\t\t\t\t.closest( \".ui-menu-item\" )\r\n\t\t\t\t\t\t.children( \".ui-menu-item-wrapper\" );\r\n\t\t\t///this._addClass( activeParent, null, \"ui-state-active\" );\r\n\t\t\tactiveParent.addClass(this.options.item.classes.active );\r\n\r\n\t\t\tif ( event && event.type === \"keydown\" ) {\r\n\t\t\t\tthis._close();\r\n\t\t\t} else {\r\n\t\t\t\tthis.timer = this._delay( function() {\r\n\t\t\t\t\tthis._close();\r\n\t\t\t\t}, this.delay );\r\n\t\t\t}\r\n\r\n\t\t\tnested = item.children( \".ui-menu\" );\r\n\t\t\tif ( nested.length && event && ( /^mouse/.test( event.type ) ) ) {\r\n\t\t\t\tthis._startOpening( nested );\r\n\t\t\t}\r\n\t\t\tthis.activeMenu = item.parent();\r\n\r\n\t\t\t///this._trigger( \"focus\", event, { item: item } );\r\n\t\t\tthis.trigger(\"focus\",{item : item})\r\n\t\t},\r\n\r\n\t\t_scrollIntoView: function( item ) {\r\n\t\t\tvar borderTop, paddingTop, offset, scroll, elementHeight, itemHeight;\r\n\t\t\tif ( this._hasScroll() ) {\r\n\t\t\t\tborderTop = parseFloat( styler.css( this.activeMenu[ 0 ], \"borderTopWidth\" ) ) || 0;\r\n\t\t\t\tpaddingTop = parseFloat( styler.css( this.activeMenu[ 0 ], \"paddingTop\" ) ) || 0;\r\n\t\t\t\toffset = item.offset().top - this.activeMenu.offset().top - borderTop - paddingTop;\r\n\t\t\t\tscroll = this.activeMenu.scrollTop();\r\n\t\t\t\telementHeight = this.activeMenu.height();\r\n\t\t\t\titemHeight = item.outerHeight();\r\n\r\n\t\t\t\tif ( offset < 0 ) {\r\n\t\t\t\t\tthis.activeMenu.scrollTop( scroll + offset );\r\n\t\t\t\t} else if ( offset + itemHeight > elementHeight ) {\r\n\t\t\t\t\tthis.activeMenu.scrollTop( scroll + offset - elementHeight + itemHeight );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tblur: function( event, fromFocus ) {\r\n\t\t\tif ( !fromFocus ) {\r\n\t\t\t\tclearTimeout( this.timer );\r\n\t\t\t}\r\n\r\n\t\t\tif ( !this.active ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t///this._removeClass( this.active.children( \".ui-menu-item-wrapper\" ),\r\n\t\t\t///\tnull, \"ui-state-active\" );\r\n\t\t\tthis.active.children( \".ui-menu-item-wrapper\" ).removeClass(this.options.item.classes.active);\r\n\r\n\t\t\t///this._trigger( \"blur\", event, { item: this.active } );\r\n\t\t\tthis.trigger( \"blur\", { item: this.active } );\r\n\t\t\tthis.active = null;\r\n\t\t},\r\n\r\n\t\t_startOpening: function( submenu ) {\r\n\t\t\tclearTimeout( this.timer );\r\n\r\n\t\t\t// Don't open if already open fixes a Firefox bug that caused a .5 pixel\r\n\t\t\t// shift in the submenu position when mousing over the caret icon\r\n\t\t\tif ( submenu.attr( \"aria-hidden\" ) !== \"true\" ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.timer = this._delay( function() {\r\n\t\t\t\tthis._close();\r\n\t\t\t\tthis._open( submenu );\r\n\t\t\t}, this.delay );\r\n\t\t},\r\n\r\n\t\t_open: function( submenu ) {\r\n\t\t\tvar position = langx.extend( {\r\n\t\t\t\tof: this.active\r\n\t\t\t}, this.options.position );\r\n\r\n\t\t\tclearTimeout( this.timer );\r\n\t\t\tthis.element.find( \".ui-menu\" ).not( submenu.parents( \".ui-menu\" ) )\r\n\t\t\t\t.hide()\r\n\t\t\t\t.attr( \"aria-hidden\", \"true\" );\r\n\r\n\t\t\tsubmenu\r\n\t\t\t\t.show()\r\n\t\t\t\t.removeAttr( \"aria-hidden\" )\r\n\t\t\t\t.attr( \"aria-expanded\", \"true\" )\r\n\t\t\t\t.position( position );\r\n\t\t},\r\n\r\n\t\tcollapseAll: function( event, all ) {\r\n\t\t\tclearTimeout( this.timer );\r\n\t\t\tthis.timer = this._delay( function() {\r\n\r\n\t\t\t\t// If we were passed an event, look for the submenu that contains the event\r\n\t\t\t\tvar currentMenu = all ? this.element :\r\n\t\t\t\t\t$( event && event.target ).closest( this.element.find( \".ui-menu\" ) );\r\n\r\n\t\t\t\t// If we found no valid submenu ancestor, use the main menu to close all\r\n\t\t\t\t// sub menus anyway\r\n\t\t\t\tif ( !currentMenu.length ) {\r\n\t\t\t\t\tcurrentMenu = this.element;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._close( currentMenu );\r\n\r\n\t\t\t\tthis.blur( event );\r\n\r\n\t\t\t\t// Work around active item staying active after menu is blurred\r\n\t\t\t\t///this._removeClass( currentMenu.find( \".ui-state-active\" ), null, \"ui-state-active\" );\r\n\t\t\t\tcurrentMenu.find( `.${this.options.item.classes.active}`).removeClass(this.options.item.classes.active );\r\n\r\n\t\t\t\tthis.activeMenu = currentMenu;\r\n\t\t\t}, all ? 0 : this.delay );\r\n\t\t},\r\n\r\n\t\t// With no arguments, closes the currently active menu - if nothing is active\r\n\t\t// it closes all menus.  If passed an argument, it will search for menus BELOW\r\n\t\t_close: function( startMenu ) {\r\n\t\t\tif ( !startMenu ) {\r\n\t\t\t\tstartMenu = this.active ? this.active.parent() : this.element;\r\n\t\t\t}\r\n\r\n\t\t\tstartMenu.find( \".ui-menu\" )\r\n\t\t\t\t.hide()\r\n\t\t\t\t.attr( \"aria-hidden\", \"true\" )\r\n\t\t\t\t.attr( \"aria-expanded\", \"false\" );\r\n\t\t},\r\n\r\n\t\t_closeOnDocumentClick: function( event ) {\r\n\t\t\treturn !$( event.target ).closest( \".ui-menu\" ).length;\r\n\t\t},\r\n\r\n\t\t_isDivider: function( item ) {\r\n\r\n\t\t\t// Match hyphen, em dash, en dash\r\n\t\t\treturn !/[^\\-\\u2014\\u2013\\s]/.test( item.text() );\r\n\t\t},\r\n\r\n\t\tcollapse: function( event ) {\r\n\t\t\tvar newItem = this.active &&\r\n\t\t\t\tthis.active.parent().closest( \".ui-menu-item\", this.element );\r\n\t\t\tif ( newItem && newItem.length ) {\r\n\t\t\t\tthis._close();\r\n\t\t\t\tthis.focus( event, newItem );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\texpand: function( event ) {\r\n\t\t\tvar newItem = this.active && this._menuItems( this.active.children( \".ui-menu\" ) ).first();\r\n\r\n\t\t\tif ( newItem && newItem.length ) {\r\n\t\t\t\tthis._open( newItem.parent() );\r\n\r\n\t\t\t\t// Delay so Firefox will not hide activedescendant change in expanding submenu from AT\r\n\t\t\t\tthis._delay( function() {\r\n\t\t\t\t\tthis.focus( event, newItem );\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tnext: function( event ) {\r\n\t\t\tthis._move( \"next\", \"first\", event );\r\n\t\t},\r\n\r\n\t\tprevious: function( event ) {\r\n\t\t\tthis._move( \"prev\", \"last\", event );\r\n\t\t},\r\n\r\n\t\tisFirstItem: function() {\r\n\t\t\treturn this.active && !this.active.prevAll( \".ui-menu-item\" ).length;\r\n\t\t},\r\n\r\n\t\tisLastItem: function() {\r\n\t\t\treturn this.active && !this.active.nextAll( \".ui-menu-item\" ).length;\r\n\t\t},\r\n\r\n\t\t_menuItems: function( menu ) {\r\n\t\t\treturn ( menu || this.element )\r\n\t\t\t\t.find( this.options.items )\r\n\t\t\t\t.filter( \".ui-menu-item\" );\r\n\t\t},\r\n\r\n\t\t_move: function( direction, filter, event ) {\r\n\t\t\tvar next;\r\n\t\t\tif ( this.active ) {\r\n\t\t\t\tif ( direction === \"first\" || direction === \"last\" ) {\r\n\t\t\t\t\tnext = this.active\r\n\t\t\t\t\t\t[ direction === \"first\" ? \"prevAll\" : \"nextAll\" ]( \".ui-menu-item\" )\r\n\t\t\t\t\t\t.last();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext = this.active\r\n\t\t\t\t\t\t[ direction + \"All\" ]( \".ui-menu-item\" )\r\n\t\t\t\t\t\t.first();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ( !next || !next.length || !this.active ) {\r\n\t\t\t\tnext = this._menuItems( this.activeMenu )[ filter ]();\r\n\t\t\t}\r\n\r\n\t\t\tthis.focus( event, next );\r\n\t\t},\r\n\r\n\t\tnextPage: function( event ) {\r\n\t\t\tvar item, base, height;\r\n\r\n\t\t\tif ( !this.active ) {\r\n\t\t\t\tthis.next( event );\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( this.isLastItem() ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( this._hasScroll() ) {\r\n\t\t\t\tbase = this.active.offset().top;\r\n\t\t\t\theight = this.element.height();\r\n\t\t\t\tthis.active.nextAll( \".ui-menu-item\" ).each( function() {\r\n\t\t\t\t\titem = $( this );\r\n\t\t\t\t\treturn item.offset().top - base - height < 0;\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tthis.focus( event, item );\r\n\t\t\t} else {\r\n\t\t\t\tthis.focus( event, this._menuItems( this.activeMenu )\r\n\t\t\t\t\t[ !this.active ? \"first\" : \"last\" ]() );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tpreviousPage: function( event ) {\r\n\t\t\tvar item, base, height;\r\n\t\t\tif ( !this.active ) {\r\n\t\t\t\tthis.next( event );\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( this.isFirstItem() ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( this._hasScroll() ) {\r\n\t\t\t\tbase = this.active.offset().top;\r\n\t\t\t\theight = this.element.height();\r\n\t\t\t\tthis.active.prevAll( \".ui-menu-item\" ).each( function() {\r\n\t\t\t\t\titem = $( this );\r\n\t\t\t\t\treturn item.offset().top - base + height > 0;\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tthis.focus( event, item );\r\n\t\t\t} else {\r\n\t\t\t\tthis.focus( event, this._menuItems( this.activeMenu ).first() );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_hasScroll: function() {\r\n\t\t\treturn this.element.outerHeight() < this.element.prop( \"scrollHeight\" );\r\n\t\t},\r\n\r\n\t\tselect: function( event ) {\r\n\r\n\t\t\t// TODO: It should never be possible to not have an active item at this\r\n\t\t\t// point, but the tests don't trigger mouseenter before click.\r\n\t\t\tthis.active = this.active || $( event.target ).closest( \".ui-menu-item\" );\r\n\t\t\tvar ui = { item: this.active };\r\n\t\t\tif ( !this.active.has( \".ui-menu\" ).length ) {\r\n\t\t\t\tthis.collapseAll( event, true );\r\n\t\t\t}\r\n\t\t\t///this._trigger( \"select\", event, ui );\r\n\t\t\tthis.trigger( \"select\", ui );\r\n\t\t},\r\n\r\n\t\t_filterMenuItems: function( character ) {\r\n\t\t\tvar escapedCharacter = character.replace( /[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\" ),\r\n\t\t\t\tregex = new RegExp( \"^\" + escapedCharacter, \"i\" );\r\n\r\n\t\t\treturn this.activeMenu\r\n\t\t\t\t.find( this.options.items )\r\n\r\n\t\t\t\t\t// Only match on items, not dividers or other content (#10571)\r\n\t\t\t\t\t.filter( \".ui-menu-item\" )\r\n\t\t\t\t\t\t.filter( function() {\r\n\t\t\t\t\t\t\treturn regex.test(\r\n\t\t\t\t\t\t\t\tlangx.trim( $( this ).children( \".ui-menu-item-wrapper\" ).text() ) );\r\n\t\t\t\t\t\t} );\r\n\t\t}\r\n\t} );\r\n\r\n  plugins.register(PopupMenu);\r\n\r\n  return menus.PopupMenu = PopupMenu;\t\r\n\r\n});\r\n"]}