{"version":3,"sources":["popup-menu.js"],"names":["define","langx","keys","noder","styler","$","lists","plugins","popups","menus","Menu","PopupMenu","inherit","klassName","pluginName","delay","options","icons","submenu","position","my","at","role","item","classes","base","active","disabled","wrapper","selector","blur","focus","select","_construct","elm","prototype","call","this","element","activeMenu","mouseHandled","lastMousePosition","x","y","attr","tabIndex","listenTo","mousedown","event","preventDefault","_activateItem","click","target","not","disable","length","isPropagationStopped","has","expand","is","closest","trigger","parents","clearTimeout","timer","mouseenter","mousemove","mouseleave","keepActiveItem","_menuItems","first","_delay","contains","collapseAll","keydown","document","_closeOnDocumentClick","actualTarget","previousFilter","clientX","clientY","currentTarget","siblings","children","removeClass","_keydown","prev","character","skip","keyCode","PAGE_UP","previousPage","PAGE_DOWN","nextPage","HOME","_move","END","UP","previous","DOWN","next","LEFT","collapse","RIGHT","ENTER","SPACE","_activate","ESC","toString","String","fromCharCode","filterTimer","match","_filterMenuItems","index","nextAll","_itemRole","menu","listbox","focused","type","_scrollIntoView","addClass","parent","_close","nested","test","_startOpening","offset","scroll","elementHeight","_hasScroll","borderTop","parseFloat","css","paddingTop","top","scrollTop","height","itemHeight","outerHeight","fromFocus","_open","extend","of","find","hide","open","all","currentMenu","startMenu","close","_isDivider","text","newItem","isFirstItem","prevAll","isLastItem","items","filter","direction","last","each","prop","ui","escapedCharacter","replace","regex","RegExp","trim","register"],"mappings":"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","file":"../popup-menu.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-devices-keyboard/keys\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-styler\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-domx-lists\",\r\n  \"skylark-domx-plugins-base\",\r\n \t\"skylark-domx-plugins-popups/popups\",\r\n  \"./menus\",\r\n  \"./menu\"\r\n],function(langx,keys,noder,styler, $,lists,plugins,popups,menus,Menu){\r\n  'use strict'\r\n\r\n  \tvar PopupMenu = Menu.inherit({\r\n\r\n    \tklassName : \"PopupMenu\",\r\n\r\n    \tpluginName : \"lark.menus.popup\",\r\n\r\n\t\tdelay: 300,\r\n\t\toptions: {\r\n\t\t\ticons: {\r\n\t\t\t\tsubmenu: \"ui-icon-caret-1-e\"\r\n\t\t\t},\r\n\t\t\t///items: \"> *\",\r\n\t\t\t///menus: \"ul\",\r\n\t\t\tposition: {\r\n\t\t\t\tmy: \"left top\",\r\n\t\t\t\tat: \"right top\"\r\n\t\t\t},\r\n\r\n\t\t\trole: \"menu\",\r\n\r\n\r\n\t\t\titem : {\r\n\t\t\t\tclasses : {\r\n\t\t\t\t\tbase : \"menu-item\",\r\n          \t\t\tactive : \"active\",\r\n          \t\t\tdisabled : \"disabled\",\r\n          \t\t\twrapper : \"menu-item-wrapper\"\r\n\t\t\t\t},\r\n\t\t\t\tselector : \"> *\"\r\n\t\t\t},\r\n\r\n\t\t\t// Callbacks\r\n\t\t\tblur: null,\r\n\t\t\tfocus: null,\r\n\t\t\tselect: null\r\n\t\t},\r\n\r\n    \t_construct : function(elm,options) {\r\n        \tMenu.prototype._construct.call(this,elm,options);\r\n\t\t\tthis.element = this.$();\r\n\r\n\t\t\tthis.activeMenu = this.element;\r\n\r\n\t\t\t// Flag used to prevent firing of the click handler\r\n\t\t\t// as the event bubbles up through nested menus\r\n\t\t\tthis.mouseHandled = false;\r\n\t\t\tthis.lastMousePosition = { x: null, y: null };\r\n\t\t\tthis.element\r\n\t\t\t\t.attr( {\r\n\t\t\t\t\trole: this.options.role,\r\n\t\t\t\t\ttabIndex: 0\r\n\t\t\t\t} );\r\n\r\n\t\t\tthis.listenTo(this.element, {\r\n\r\n\t\t\t\t// Prevent focus from sticking to links inside menu after clicking\r\n\t\t\t\t// them (focus should always stay on UL during navigation).\r\n\t\t\t\t'mousedown': function( event ) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\t\tthis._activateItem( event );\r\n\t\t\t\t},\r\n\t\t\t\t\"click\": function( event ) {\r\n\t\t\t\t\tvar target = $( event.target );\r\n\t\t\t\t\t//var active = $( $.ui.safeActiveElement( this.document[ 0 ] ) );\r\n\t\t\t\t\tvar active = $(noder.active());\r\n\t\t\t\t\tif ( !this.mouseHandled && target.not(`.${this.options.item.classes.disable}`).length ) {\r\n\t\t\t\t\t\tthis.select( event );\r\n\r\n\t\t\t\t\t\t// Only set the mouseHandled flag if the event will bubble, see #9469.\r\n\t\t\t\t\t\tif ( !event.isPropagationStopped() ) {\r\n\t\t\t\t\t\t\tthis.mouseHandled = true;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Open submenu on click\r\n\t\t\t\t\t\tif ( target.has(`.${this.options.submenu.classes.base}`).length ) {\r\n\t\t\t\t\t\t\tthis.expand( event );\r\n\t\t\t\t\t\t} else if ( !this.element.is( \":focus\" ) &&\r\n\t\t\t\t\t\t\t\tactive.closest( `.${this.options.submenu.classes.base}` ).length ) {\r\n\r\n\t\t\t\t\t\t\t// Redirect focus to the menu\r\n\t\t\t\t\t\t\tthis.element.trigger( \"focus\", [ true ] );\r\n\r\n\t\t\t\t\t\t\t// If the active item is on the top level, let it stay active.\r\n\t\t\t\t\t\t\t// Otherwise, blur the active item since it is no longer visible.\r\n\t\t\t\t\t\t\tif ( this.active && this.active.parents( `.${this.options.submenu.classes.base}` ).length === 1 ) {\r\n\t\t\t\t\t\t\t\tclearTimeout( this.timer );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"mouseenter\": \"_activateItem\",\r\n\t\t\t\t\"mousemove\": \"_activateItem\",\r\n\t\t\t}, `.${this.options.item.classes.base}`);\r\n\r\n\t\t\tthis.listenTo(this.element, {\r\n\t\t\t\t\"mouseleave\": \"collapseAll\",\r\n\t\t\t\t\"focus\": function( event, keepActiveItem ) {\r\n\r\n\t\t\t\t\t// If there's already an active item, keep it active\r\n\t\t\t\t\t// If not, activate the first item\r\n\t\t\t\t\tvar item = this.active || this._menuItems().first();\r\n\r\n\t\t\t\t\tif ( !keepActiveItem ) {\r\n\t\t\t\t\t\tthis.focus( event, item );\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"blur\": function( event ) {\r\n\t\t\t\t\tthis._delay( function() {\r\n\t\t\t\t\t\tvar notContained = !noder.contains(\r\n\t\t\t\t\t\t\tthis.element[ 0 ],\r\n\t\t\t\t\t\t\t//$.ui.safeActiveElement( this.document[ 0 ] )\r\n\t\t\t\t\t\t\tnoder.active()\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tif ( notContained ) {\r\n\t\t\t\t\t\t\tthis.collapseAll( event );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} );\r\n\t\t\t\t},\r\n\t\t\t\t\"keydown\": \"_keydown\"\r\n\t\t\t} );\r\n\r\n\t\t\tthis.listenTo(this.element, \"mouseleave\",  `.${this.options.submenu.classes.base}`, \"collapseAll\");\r\n\r\n\t\t\t///this.refresh();\r\n\r\n\t\t\t// Clicks outside of a menu collapse any open menus\r\n\t\t\tthis.listenTo( $(document), {\r\n\t\t\t\tclick: function( event ) {\r\n\t\t\t\t\tif ( this._closeOnDocumentClick( event ) ) {\r\n\t\t\t\t\t\tthis.collapseAll( event, true );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Reset the mouseHandled flag\r\n\t\t\t\t\tthis.mouseHandled = false;\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t},\r\n\r\n\t\t_activateItem: function( event ) {\r\n\r\n\t\t\t// Ignore mouse events while typeahead is active, see #10458.\r\n\t\t\t// Prevents focusing the wrong item when typeahead causes a scroll while the mouse\r\n\t\t\t// is over an item in the menu\r\n\t\t\tif ( this.previousFilter ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If the mouse didn't actually move, but the page was scrolled, ignore the event (#9356)\r\n\t\t\tif ( event.clientX === this.lastMousePosition.x &&\r\n\t\t\t\t\tevent.clientY === this.lastMousePosition.y ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.lastMousePosition = {\r\n\t\t\t\tx: event.clientX,\r\n\t\t\t\ty: event.clientY\r\n\t\t\t};\r\n\r\n\t\t\tvar actualTarget = $( event.target ).closest( `.${this.options.item.classes.base}` ),\r\n\t\t\t\ttarget = $( event.currentTarget );\r\n\r\n\t\t\t// Ignore bubbled events on parent items, see #11641\r\n\t\t\tif ( actualTarget[ 0 ] !== target[ 0 ] ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If the item is already active, there's nothing to do\r\n\t\t\tif ( target.is(`.${this.options.item.classes.active}`) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove ui-state-active class from siblings of the newly focused menu item\r\n\t\t\t// to avoid a jump caused by adjacent elements both having a class with a border\r\n\t\t\t///this._removeClass( target.siblings().children( \".ui-state-active\" ),\r\n\t\t\t///\tnull, \"ui-state-active\" );\r\n\t\t\ttarget.siblings().children( `.${this.options.item.classes.active}` ).removeClass(this.options.item.classes.active);\r\n\t\t\tthis.focus( event, target );\r\n\t\t},\r\n\r\n\t\t_keydown: function( event ) {\r\n\t\t\tvar match, prev, character, skip,\r\n\t\t\t\tpreventDefault = true;\r\n\r\n\t\t\tswitch ( event.keyCode ) {\r\n\t\t\tcase keys.PAGE_UP:\r\n\t\t\t\tthis.previousPage( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.PAGE_DOWN:\r\n\t\t\t\tthis.nextPage( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.HOME:\r\n\t\t\t\tthis._move( \"first\", \"first\", event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.END:\r\n\t\t\t\tthis._move( \"last\", \"last\", event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.UP:\r\n\t\t\t\tthis.previous( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.DOWN:\r\n\t\t\t\tthis.next( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.LEFT:\r\n\t\t\t\tthis.collapse( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.RIGHT:\r\n\t\t\t\tif ( this.active && !this.active.is( `.${this.options.item.classes.disabled}`) ) {\r\n\t\t\t\t\tthis.expand( event );\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.ENTER:\r\n\t\t\tcase keys.SPACE:\r\n\t\t\t\tthis._activate( event );\r\n\t\t\t\tbreak;\r\n\t\t\tcase keys.ESC:\r\n\t\t\t\tthis.collapse( event );\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tpreventDefault = false;\r\n\t\t\t\tprev = this.previousFilter || \"\";\r\n\t\t\t\tskip = false;\r\n\r\n\t\t\t\t// Support number pad values\r\n\t\t\t\tcharacter = event.keyCode >= 96 && event.keyCode <= 105 ?\r\n\t\t\t\t\t( event.keyCode - 96 ).toString() : String.fromCharCode( event.keyCode );\r\n\r\n\t\t\t\tclearTimeout( this.filterTimer );\r\n\r\n\t\t\t\tif ( character === prev ) {\r\n\t\t\t\t\tskip = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcharacter = prev + character;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmatch = this._filterMenuItems( character );\r\n\t\t\t\tmatch = skip && match.index( this.active.next() ) !== -1 ?\r\n\t\t\t\t\tthis.active.nextAll( `.${this.options.item.classes.base}` ) :\r\n\t\t\t\t\tmatch;\r\n\r\n\t\t\t\t// If no matches on the current filter, reset to the last character pressed\r\n\t\t\t\t// to move down the menu to the first item that starts with that character\r\n\t\t\t\tif ( !match.length ) {\r\n\t\t\t\t\tcharacter = String.fromCharCode( event.keyCode );\r\n\t\t\t\t\tmatch = this._filterMenuItems( character );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( match.length ) {\r\n\t\t\t\t\tthis.focus( event, match );\r\n\t\t\t\t\tthis.previousFilter = character;\r\n\t\t\t\t\tthis.filterTimer = this._delay( function() {\r\n\t\t\t\t\t\tdelete this.previousFilter;\r\n\t\t\t\t\t}, 1000 );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete this.previousFilter;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( preventDefault ) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_activate: function( event ) {\r\n\t\t\tif ( this.active && !this.active.is( `.${this.options.item.classes.disabled}` ) ) {\r\n\t\t\t\tif ( this.active.children( \"[aria-haspopup='true']\" ).length ) {\r\n\t\t\t\t\tthis.expand( event );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.select( event );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_itemRole: function() {\r\n\t\t\treturn {\r\n\t\t\t\tmenu: \"menuitem\",\r\n\t\t\t\tlistbox: \"option\"\r\n\t\t\t}[ this.options.role ];\r\n\t\t},\r\n\r\n\t\tfocus: function( event, item ) {\r\n\t\t\tvar nested, focused, activeParent;\r\n\t\t\tthis.blur( event, event && event.type === \"focus\" );\r\n\r\n\t\t\tthis._scrollIntoView( item );\r\n\r\n\t\t\tthis.active = item.first();\r\n\r\n\t\t\tfocused = this.active.children( `.${this.options.item.classes.wrapper}` );\r\n\t\t\t///this._addClass( focused, null, \"ui-state-active\" );\r\n\t\t\tfocused.addClass(this.options.item.classes.active);\r\n\r\n\t\t\t// Only update aria-activedescendant if there's a role\r\n\t\t\t// otherwise we assume focus is managed elsewhere\r\n\t\t\tif ( this.options.role ) {\r\n\t\t\t\tthis.element.attr( \"aria-activedescendant\", focused.attr( \"id\" ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Highlight active parent menu item, if any\r\n\t\t\tactiveParent = this.active\r\n\t\t\t\t.parent()\r\n\t\t\t\t\t.closest( `.${this.options.item.classes.base}`)\r\n\t\t\t\t\t\t.children( `.${this.options.item.classes.wrapper}`);\r\n\t\t\t///this._addClass( activeParent, null, \"ui-state-active\" );\r\n\t\t\tactiveParent.addClass(this.options.item.classes.active );\r\n\r\n\t\t\tif ( event && event.type === \"keydown\" ) {\r\n\t\t\t\tthis._close();\r\n\t\t\t} else {\r\n\t\t\t\tthis.timer = this._delay( function() {\r\n\t\t\t\t\tthis._close();\r\n\t\t\t\t}, this.delay );\r\n\t\t\t}\r\n\r\n\t\t\tnested = item.children( `.${this.options.submenu.classes.base}` );\r\n\t\t\tif ( nested.length && event && ( /^mouse/.test( event.type ) ) ) {\r\n\t\t\t\tthis._startOpening( nested );\r\n\t\t\t}\r\n\t\t\tthis.activeMenu = item.parent();\r\n\r\n\t\t\t///this._trigger( \"focus\", event, { item: item } );\r\n\t\t\tthis.trigger(\"focus\",{item : item})\r\n\t\t},\r\n\r\n\t\t_scrollIntoView: function( item ) {\r\n\t\t\tvar borderTop, paddingTop, offset, scroll, elementHeight, itemHeight;\r\n\t\t\tif ( this._hasScroll() ) {\r\n\t\t\t\tborderTop = parseFloat( styler.css( this.activeMenu[ 0 ], \"borderTopWidth\" ) ) || 0;\r\n\t\t\t\tpaddingTop = parseFloat( styler.css( this.activeMenu[ 0 ], \"paddingTop\" ) ) || 0;\r\n\t\t\t\toffset = item.offset().top - this.activeMenu.offset().top - borderTop - paddingTop;\r\n\t\t\t\tscroll = this.activeMenu.scrollTop();\r\n\t\t\t\telementHeight = this.activeMenu.height();\r\n\t\t\t\titemHeight = item.outerHeight();\r\n\r\n\t\t\t\tif ( offset < 0 ) {\r\n\t\t\t\t\tthis.activeMenu.scrollTop( scroll + offset );\r\n\t\t\t\t} else if ( offset + itemHeight > elementHeight ) {\r\n\t\t\t\t\tthis.activeMenu.scrollTop( scroll + offset - elementHeight + itemHeight );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tblur: function( event, fromFocus ) {\r\n\t\t\tif ( !fromFocus ) {\r\n\t\t\t\tclearTimeout( this.timer );\r\n\t\t\t}\r\n\r\n\t\t\tif ( !this.active ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t///this._removeClass( this.active.children( \".ui-menu-item-wrapper\" ),\r\n\t\t\t///\tnull, \"ui-state-active\" );\r\n\t\t\tthis.active.children( `.${this.options.item.classes.wrapper}` ).removeClass(this.options.item.classes.active);\r\n\r\n\t\t\t///this._trigger( \"blur\", event, { item: this.active } );\r\n\t\t\tthis.trigger( \"blur\", { item: this.active } );\r\n\t\t\tthis.active = null;\r\n\t\t},\r\n\r\n\t\t_startOpening: function( submenu ) {\r\n\t\t\tclearTimeout( this.timer );\r\n\r\n\t\t\t// Don't open if already open fixes a Firefox bug that caused a .5 pixel\r\n\t\t\t// shift in the submenu position when mousing over the caret icon\r\n\t\t\t///if ( submenu.attr( \"aria-hidden\" ) !== \"true\" ) {\r\n\t\t\t///\treturn;\r\n\t\t\t///}\r\n\r\n\t\t\tthis.timer = this._delay( function() {\r\n\t\t\t\tthis._close();\r\n\t\t\t\tthis._open( submenu );\r\n\t\t\t}, this.delay );\r\n\t\t},\r\n\r\n\t\t_open: function( submenu ) {\r\n\t\t\tvar position = langx.extend( {\r\n\t\t\t\tof: this.active\r\n\t\t\t}, this.options.position );\r\n\r\n\t\t\tclearTimeout( this.timer );\r\n\t\t\tthis.element.find( `.${this.options.submenu.classes.base}`).not( submenu.parents( `.${this.options.submenu.classes.base}` ) )\r\n\t\t\t\t.hide()\r\n\t\t\t\t.attr( \"aria-hidden\", \"true\" );\r\n\r\n\t\t\t//submenu\r\n\t\t\t//\t.show()\r\n\t\t\t//\t.removeAttr( \"aria-hidden\" )\r\n\t\t\t//\t.attr( \"aria-expanded\", \"true\" )\r\n\t\t\t//\t.position( position );\r\n\t\t\tpopups.open(submenu.attr( \"aria-expanded\", \"true\" ),{\r\n\t\t\t\tposition\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tcollapseAll: function( event, all ) {\r\n\t\t\tclearTimeout( this.timer );\r\n\t\t\tthis.timer = this._delay( function() {\r\n\r\n\t\t\t\t// If we were passed an event, look for the submenu that contains the event\r\n\t\t\t\tvar currentMenu = all ? this.element :\r\n\t\t\t\t\t$( event && event.target ).closest( this.element.find( `.${this.options.submenu.classes.base}`) );\r\n\r\n\t\t\t\t// If we found no valid submenu ancestor, use the main menu to close all\r\n\t\t\t\t// sub menus anyway\r\n\t\t\t\tif ( !currentMenu.length ) {\r\n\t\t\t\t\tcurrentMenu = this.element;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._close( currentMenu );\r\n\r\n\t\t\t\tthis.blur( event );\r\n\r\n\t\t\t\t// Work around active item staying active after menu is blurred\r\n\t\t\t\t///this._removeClass( currentMenu.find( \".ui-state-active\" ), null, \"ui-state-active\" );\r\n\t\t\t\tcurrentMenu.find( `.${this.options.item.classes.active}`).removeClass(this.options.item.classes.active );\r\n\r\n\t\t\t\tthis.activeMenu = currentMenu;\r\n\t\t\t}, all ? 0 : this.delay );\r\n\t\t},\r\n\r\n\t\t// With no arguments, closes the currently active menu - if nothing is active\r\n\t\t// it closes all menus.  If passed an argument, it will search for menus BELOW\r\n\t\t_close: function( startMenu ) {\r\n\t\t\tif ( !startMenu ) {\r\n\t\t\t\tstartMenu = this.active ? this.active.parent() : this.element;\r\n\t\t\t}\r\n\r\n\t\t\t//startMenu.find(`.${this.options.submenu.classes.base}` )\r\n\t\t\t//\t.hide()\r\n\t\t\t//\t.attr( \"aria-hidden\", \"true\" )\r\n\t\t\t//\t.attr( \"aria-expanded\", \"false\" );\r\n\t\t\tpopups.close(startMenu.find(`.${this.options.submenu.classes.base}` ).attr( \"aria-expanded\", \"false\" ));\r\n\t\t},\r\n\r\n\t\t_closeOnDocumentClick: function( event ) {\r\n\t\t\treturn !$( event.target ).closest(`.${this.options.submenu.classes.base}` ).length;\r\n\t\t},\r\n\r\n\t\t_isDivider: function( item ) {\r\n\r\n\t\t\t// Match hyphen, em dash, en dash\r\n\t\t\treturn !/[^\\-\\u2014\\u2013\\s]/.test( item.text() );\r\n\t\t},\r\n\r\n\t\tcollapse: function( event ) {\r\n\t\t\tvar newItem = this.active &&\r\n\t\t\t\tthis.active.parent().closest( `.${this.options.item.classes.base}`, this.element );\r\n\t\t\tif ( newItem && newItem.length ) {\r\n\t\t\t\tthis._close();\r\n\t\t\t\tthis.focus( event, newItem );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\texpand: function( event ) {\r\n\t\t\tvar newItem = this.active && this._menuItems( this.active.children( `.${this.options.submenu.classes.base}` ) ).first();\r\n\r\n\t\t\tif ( newItem && newItem.length ) {\r\n\t\t\t\tthis._open( newItem.parent() );\r\n\r\n\t\t\t\t// Delay so Firefox will not hide activedescendant change in expanding submenu from AT\r\n\t\t\t\tthis._delay( function() {\r\n\t\t\t\t\tthis.focus( event, newItem );\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tnext: function( event ) {\r\n\t\t\tthis._move( \"next\", \"first\", event );\r\n\t\t},\r\n\r\n\t\tprevious: function( event ) {\r\n\t\t\tthis._move( \"prev\", \"last\", event );\r\n\t\t},\r\n\r\n\t\tisFirstItem: function() {\r\n\t\t\treturn this.active && !this.active.prevAll( `.${this.options.item.classes.base}` ).length;\r\n\t\t},\r\n\r\n\t\tisLastItem: function() {\r\n\t\t\treturn this.active && !this.active.nextAll( `.${this.options.item.classes.base}` ).length;\r\n\t\t},\r\n\r\n\t\t_menuItems: function( menu ) {\r\n\t\t\treturn ( menu || this.element )\r\n\t\t\t\t.find( this.options.items )\r\n\t\t\t\t.filter( `.${this.options.item.classes.base}` );\r\n\t\t},\r\n\r\n\t\t_move: function( direction, filter, event ) {\r\n\t\t\tvar next;\r\n\t\t\tif ( this.active ) {\r\n\t\t\t\tif ( direction === \"first\" || direction === \"last\" ) {\r\n\t\t\t\t\tnext = this.active\r\n\t\t\t\t\t\t[ direction === \"first\" ? \"prevAll\" : \"nextAll\" ]( `.${this.options.item.classes.base}` )\r\n\t\t\t\t\t\t.last();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext = this.active\r\n\t\t\t\t\t\t[ direction + \"All\" ]( `.${this.options.item.classes.base}` )\r\n\t\t\t\t\t\t.first();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ( !next || !next.length || !this.active ) {\r\n\t\t\t\tnext = this._menuItems( this.activeMenu )[ filter ]();\r\n\t\t\t}\r\n\r\n\t\t\tthis.focus( event, next );\r\n\t\t},\r\n\r\n\t\tnextPage: function( event ) {\r\n\t\t\tvar item, base, height;\r\n\r\n\t\t\tif ( !this.active ) {\r\n\t\t\t\tthis.next( event );\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( this.isLastItem() ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( this._hasScroll() ) {\r\n\t\t\t\tbase = this.active.offset().top;\r\n\t\t\t\theight = this.element.height();\r\n\t\t\t\tthis.active.nextAll( `.${this.options.item.classes.base}` ).each( function() {\r\n\t\t\t\t\titem = $( this );\r\n\t\t\t\t\treturn item.offset().top - base - height < 0;\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tthis.focus( event, item );\r\n\t\t\t} else {\r\n\t\t\t\tthis.focus( event, this._menuItems( this.activeMenu )\r\n\t\t\t\t\t[ !this.active ? \"first\" : \"last\" ]() );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tpreviousPage: function( event ) {\r\n\t\t\tvar item, base, height;\r\n\t\t\tif ( !this.active ) {\r\n\t\t\t\tthis.next( event );\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( this.isFirstItem() ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ( this._hasScroll() ) {\r\n\t\t\t\tbase = this.active.offset().top;\r\n\t\t\t\theight = this.element.height();\r\n\t\t\t\tthis.active.prevAll( `.${this.options.item.classes.base}` ).each( function() {\r\n\t\t\t\t\titem = $( this );\r\n\t\t\t\t\treturn item.offset().top - base + height > 0;\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tthis.focus( event, item );\r\n\t\t\t} else {\r\n\t\t\t\tthis.focus( event, this._menuItems( this.activeMenu ).first() );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_hasScroll: function() {\r\n\t\t\treturn this.element.outerHeight() < this.element.prop( \"scrollHeight\" );\r\n\t\t},\r\n\r\n\t\tselect: function( event ) {\r\n\r\n\t\t\t// TODO: It should never be possible to not have an active item at this\r\n\t\t\t// point, but the tests don't trigger mouseenter before click.\r\n\t\t\tthis.active = this.active || $( event.target ).closest( `.${this.options.item.classes.base}` );\r\n\t\t\tvar ui = { item: this.active };\r\n\t\t\tif ( !this.active.has( `.${this.options.submenu.classes.base}` ).length ) {\r\n\t\t\t\tthis.collapseAll( event, true );\r\n\t\t\t}\r\n\t\t\t///this._trigger( \"select\", event, ui );\r\n\t\t\tthis.trigger( \"select\", ui );\r\n\t\t},\r\n\r\n\t\t_filterMenuItems: function( character ) {\r\n\t\t\tvar escapedCharacter = character.replace( /[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\" ),\r\n\t\t\t\tregex = new RegExp( \"^\" + escapedCharacter, \"i\" );\r\n\r\n\t\t\treturn this.activeMenu\r\n\t\t\t\t.find( this.options.items )\r\n\r\n\t\t\t\t\t// Only match on items, not dividers or other content (#10571)\r\n\t\t\t\t\t.filter( `.${this.options.item.classes.base}` )\r\n\t\t\t\t\t\t.filter( function() {\r\n\t\t\t\t\t\t\treturn regex.test(\r\n\t\t\t\t\t\t\t\tlangx.trim( $( this ).children( `.${this.options.item.classes.wrapper}`).text() ) );\r\n\t\t\t\t\t\t} );\r\n\t\t}\r\n\t} );\r\n\r\n  plugins.register(PopupMenu);\r\n\r\n  return menus.PopupMenu = PopupMenu;\t\r\n\r\n});\r\n"]}